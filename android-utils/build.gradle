apply plugin: 'com.android.library'
apply plugin: 'kotlin-android'
apply plugin: 'org.jetbrains.dokka-android'
apply plugin: 'maven-publish'

android {
	compileSdkVersion 28
	compileOptions {
		sourceCompatibility JavaVersion.VERSION_1_8
		targetCompatibility JavaVersion.VERSION_1_8
	}

	defaultConfig {
		minSdkVersion 21
		targetSdkVersion 28

		versionCode 1
		versionName = "$version"
		// append version to android build-artifacts:
		android.libraryVariants.all { outputs.all {
			outputFileName = outputFileName.replace("$archivesBaseName", "$archivesBaseName-$version") }
		}

		consumerProguardFile('proguard-rules.pro')
	}

	buildTypes {
		release {
			minifyEnabled false

			// strip "-release"-qualifier from artifact file-names, because release is the default:
			android.libraryVariants.matching { variant -> variant.name == "release" }.all { outputs.all {
				outputFileName = outputFileName.replace("-release", "") }
			}
		}
	}

	sourceSets {
		main.java.srcDirs += 'src/main/kotlin/'
		test.java.srcDirs += 'src/test/kotlin/'
	}
}

dependencies {
	implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"

	testImplementation 'junit:junit:4.12'
	testImplementation "org.jetbrains.kotlin:kotlin-test-junit:$kotlin_version"
}

task sourcesJar(type: Jar) {
	from android.sourceSets.main.java.srcDirs
	classifier = 'sources'
}

task kdocJar(type: Jar, dependsOn: dokka) {
	from "$buildDir/dokka"
	classifier = 'kdoc'
	archiveName = "${project.name}-${version}-${classifier}.jar"
}

publishing {
	publications {
		maven(MavenPublication) {
			artifact(bundleRelease)
			artifact(sourcesJar)
			artifact(kdocJar)
		}
	}
}
